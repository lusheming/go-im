<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Go-IM 管理后台</title>
  
  <!-- Element Plus CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.4/dist/index.css">
  <!-- Element Plus Icons -->
  <link rel="stylesheet" href="https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.css">
  
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .admin-container { height: 100vh; display: flex; flex-direction: column; }
    .admin-header { background: #409eff; color: white; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; height: 60px; }
    .admin-main { flex: 1; display: flex; }
    .admin-sidebar { width: 240px; background: #f5f5f5; border-right: 1px solid #e6e6e6; }
    .admin-content { flex: 1; padding: 20px; background: #fafafa; overflow-y: auto; }
    .logo { font-size: 20px; font-weight: bold; }
    .menu-item { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #e6e6e6; }
    .menu-item:hover, .menu-item.active { background: #409eff; color: white; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .stat-number { font-size: 32px; font-weight: bold; color: #409eff; }
    .stat-label { color: #666; margin-top: 8px; }
    .content-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .login-container { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .login-form { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); width: 400px; }
  </style>
</head>
<body>
  <div id="app">
    <!-- 登录页面 -->
    <div v-if="!isLoggedIn" class="login-container">
      <div class="login-form">
        <h2 style="text-align: center; margin-bottom: 30px; color: #333;">管理后台登录</h2>
        <el-form :model="loginForm" @submit.prevent="handleLogin">
          <el-form-item>
            <el-input v-model="loginForm.username" placeholder="管理员用户名" size="large">
              <template #prefix><el-icon><User /></el-icon></template>
            </el-input>
          </el-form-item>
          <el-form-item>
            <el-input v-model="loginForm.password" type="password" placeholder="密码" size="large" @keyup.enter="handleLogin">
              <template #prefix><el-icon><Lock /></el-icon></template>
            </el-input>
          </el-form-item>
          <el-form-item>
            <el-button type="primary" size="large" style="width: 100%;" @click="handleLogin" :loading="loginLoading">
              登录
            </el-button>
          </el-form-item>
        </el-form>
      </div>
    </div>

    <!-- 管理界面 -->
    <div v-else class="admin-container">
      <!-- 头部 -->
      <div class="admin-header">
        <div class="logo">Go-IM 管理后台</div>
        <div style="display: flex; align-items: center; gap: 16px;">
          <span>欢迎，{{ currentUser.username }}</span>
          <el-button type="info" plain @click="handleLogout">退出</el-button>
        </div>
      </div>

      <div class="admin-main">
        <!-- 侧边栏 -->
        <div class="admin-sidebar">
          <div class="menu-item" :class="{active: activeTab === 'dashboard'}" @click="setActiveTab('dashboard')">
            <el-icon style="margin-right: 8px;"><DataBoard /></el-icon>仪表盘
          </div>
          <div class="menu-item" :class="{active: activeTab === 'users'}" @click="setActiveTab('users')">
            <el-icon style="margin-right: 8px;"><User /></el-icon>用户管理
          </div>
          <div class="menu-item" :class="{active: activeTab === 'groups'}" @click="setActiveTab('groups')">
            <el-icon style="margin-right: 8px;"><Users /></el-icon>群组管理
          </div>
          <div class="menu-item" :class="{active: activeTab === 'messages'}" @click="setActiveTab('messages')">
            <el-icon style="margin-right: 8px;"><ChatDotRound /></el-icon>消息统计
          </div>
          <div class="menu-item" :class="{active: activeTab === 'settings'}" @click="setActiveTab('settings')">
            <el-icon style="margin-right: 8px;"><Setting /></el-icon>系统设置
          </div>
        </div>

        <!-- 主内容区 -->
        <div class="admin-content">
          <!-- 仪表盘 -->
          <div v-if="activeTab === 'dashboard'">
            <h2>系统概览</h2>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number">{{ stats.totalUsers || 0 }}</div>
                <div class="stat-label">总用户数</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">{{ stats.onlineUsers || 0 }}</div>
                <div class="stat-label">在线用户</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">{{ stats.totalGroups || 0 }}</div>
                <div class="stat-label">总群组数</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">{{ stats.totalMessages || 0 }}</div>
                <div class="stat-label">总消息数</div>
              </div>
            </div>
            
            <div class="content-section">
              <h3>最近活动</h3>
              <el-table :data="recentActivities" style="width: 100%;">
                <el-table-column prop="type" label="类型" width="120" />
                <el-table-column prop="user" label="用户" width="150" />
                <el-table-column prop="content" label="内容" />
                <el-table-column prop="time" label="时间" width="180" />
              </el-table>
            </div>
          </div>

          <!-- 用户管理 -->
          <div v-if="activeTab === 'users'">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h2>用户管理</h2>
              <el-button type="primary" @click="refreshUsers">刷新</el-button>
            </div>
            
            <div class="content-section">
              <el-table :data="users" style="width: 100%;" v-loading="usersLoading">
                <el-table-column prop="id" label="用户ID" width="200" />
                <el-table-column prop="username" label="用户名" width="150" />
                <el-table-column prop="nickname" label="昵称" width="150" />
                <el-table-column prop="createdAt" label="注册时间" width="180" />
                <el-table-column label="在线状态" width="120">
                  <template #default="scope">
                    <el-tag :type="scope.row.online ? 'success' : 'info'">
                      {{ scope.row.online ? '在线' : '离线' }}
                    </el-tag>
                  </template>
                </el-table-column>
                <el-table-column label="操作" width="200">
                  <template #default="scope">
                    <el-button size="small" @click="viewUserDetails(scope.row)">详情</el-button>
                    <el-button size="small" type="danger" @click="banUser(scope.row)">禁用</el-button>
                  </template>
                </el-table-column>
              </el-table>
            </div>
          </div>

          <!-- 群组管理 -->
          <div v-if="activeTab === 'groups'">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h2>群组管理</h2>
              <el-button type="primary" @click="refreshGroups">刷新</el-button>
            </div>
            
            <div class="content-section">
              <el-table :data="groups" style="width: 100%;" v-loading="groupsLoading">
                <el-table-column prop="id" label="群组ID" width="200" />
                <el-table-column prop="name" label="群组名称" width="200" />
                <el-table-column prop="ownerId" label="群主ID" width="150" />
                <el-table-column prop="memberCount" label="成员数量" width="120" />
                <el-table-column prop="createdAt" label="创建时间" width="180" />
                <el-table-column label="操作" width="200">
                  <template #default="scope">
                    <el-button size="small" @click="viewGroupDetails(scope.row)">详情</el-button>
                    <el-button size="small" type="danger" @click="disbandGroup(scope.row)">解散</el-button>
                  </template>
                </el-table-column>
              </el-table>
            </div>
          </div>

          <!-- 消息统计 -->
          <div v-if="activeTab === 'messages'">
            <h2>消息统计</h2>
            <div class="content-section">
              <div style="margin-bottom: 20px;">
                <el-date-picker
                  v-model="dateRange"
                  type="daterange"
                  range-separator="至"
                  start-placeholder="开始日期"
                  end-placeholder="结束日期"
                  @change="refreshMessageStats"
                />
                <el-button type="primary" style="margin-left: 10px;" @click="refreshMessageStats">查询</el-button>
              </div>
              
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-number">{{ messageStats.todayMessages || 0 }}</div>
                  <div class="stat-label">今日消息数</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">{{ messageStats.weekMessages || 0 }}</div>
                  <div class="stat-label">本周消息数</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">{{ messageStats.monthMessages || 0 }}</div>
                  <div class="stat-label">本月消息数</div>
                </div>
              </div>
            </div>
          </div>

          <!-- 系统设置 -->
          <div v-if="activeTab === 'settings'">
            <h2>系统设置</h2>
            <div class="content-section">
              <el-form :model="settings" label-width="120px">
                <el-form-item label="系统名称">
                  <el-input v-model="settings.systemName" style="width: 300px;" />
                </el-form-item>
                <el-form-item label="最大群成员">
                  <el-input-number v-model="settings.maxGroupMembers" :min="10" :max="1000" />
                </el-form-item>
                <el-form-item label="消息保留天数">
                  <el-input-number v-model="settings.messageRetentionDays" :min="1" :max="365" />
                </el-form-item>
                <el-form-item label="启用注册">
                  <el-switch v-model="settings.enableRegistration" />
                </el-form-item>
                <el-form-item>
                  <el-button type="primary" @click="saveSettings">保存设置</el-button>
                </el-form-item>
              </el-form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3.3.8/dist/vue.global.js"></script>
  <!-- Element Plus -->
  <script src="https://unpkg.com/element-plus@2.4.4/dist/index.full.js"></script>
  <!-- Element Plus Icons -->
  <script src="https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.iife.js"></script>
  
  <script src="/admin/main.js"></script>
</body>
</html> 