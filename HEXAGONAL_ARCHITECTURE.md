# Go-IM å…­è¾¹å½¢æ¶æ„é‡æ„è¯´æ˜

## ğŸ“‹ æ¶æ„æ¦‚è¿°

é¡¹ç›®å·²æˆåŠŸé‡æ„ä¸ºå…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰ï¼Œä¹Ÿç§°ä¸ºç«¯å£é€‚é…å™¨æ¶æ„ï¼ˆPorts and Adaptersï¼‰ã€‚è¿™ç§æ¶æ„æ¨¡å¼æä¾›äº†æ¸…æ™°çš„åˆ†å±‚ç»“æ„ï¼Œå¢å¼ºäº†ä»£ç çš„å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚

## ğŸ—ï¸ æ¶æ„åˆ†å±‚

### 1. é¢†åŸŸå±‚ (Domain Layer)
**ä½ç½®**: `internal/domain/`

**èŒè´£**: åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æŠ€æœ¯

#### ğŸ“ å®ä½“ (Entities)
- `entities/user.go` - ç”¨æˆ·é¢†åŸŸå®ä½“
- `entities/message.go` - æ¶ˆæ¯é¢†åŸŸå®ä½“  
- `entities/group.go` - ç¾¤ç»„å’Œç¾¤ç»„æˆå‘˜å®ä½“

#### ğŸ“ å€¼å¯¹è±¡ (Value Objects)
- `valueobjects/conversation_type.go` - ä¼šè¯ç±»å‹å€¼å¯¹è±¡
- `valueobjects/member_role.go` - æˆå‘˜è§’è‰²å€¼å¯¹è±¡

#### ğŸ“ é¢†åŸŸæœåŠ¡ (Domain Services)
- åŒ…å«è·¨å®ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¾…æ‰©å±•ï¼‰

### 2. åº”ç”¨å±‚ (Application Layer)  
**ä½ç½®**: `internal/application/`

**èŒè´£**: ç¼–æ’ä¸šåŠ¡ç”¨ä¾‹ï¼Œå®šä¹‰ç«¯å£æ¥å£

#### ğŸ“ ç«¯å£ (Ports)
- `ports/repositories.go` - æ•°æ®ä»“å‚¨ç«¯å£æ¥å£
- `ports/services.go` - å¤–éƒ¨æœåŠ¡ç«¯å£æ¥å£

#### ğŸ“ ç”¨ä¾‹ (Use Cases)
- `usecases/user_usecase.go` - ç”¨æˆ·ç›¸å…³ç”¨ä¾‹
- `usecases/message_usecase.go` - æ¶ˆæ¯ç›¸å…³ç”¨ä¾‹

### 3. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
**ä½ç½®**: `internal/infrastructure/`

**èŒè´£**: å®ç°ç«¯å£æ¥å£ï¼Œæä¾›æŠ€æœ¯å®ç°

#### ğŸ“ æŒä¹…åŒ–é€‚é…å™¨
- `adapters/persistence/user_repository.go` - ç”¨æˆ·ä»“å‚¨å®ç°

#### ğŸ“ å¤–éƒ¨æœåŠ¡é€‚é…å™¨  
- `adapters/external/id_generator.go` - IDç”Ÿæˆå™¨å®ç°
- `adapters/external/password_service.go` - å¯†ç æœåŠ¡å®ç°

### 4. è¡¨ç¤ºå±‚ (Presentation Layer)
**ä½ç½®**: `internal/presentation/`

**èŒè´£**: å¤„ç†å¤–éƒ¨è¯·æ±‚ï¼Œé€‚é…ä¸åŒåè®®

#### ğŸ“ HTTPé€‚é…å™¨
- `http/user_handler.go` - ç”¨æˆ·HTTPå¤„ç†å™¨

#### ğŸ“ WebSocketé€‚é…å™¨
- å¾…å®ç°ï¼šWebSocketæ¶ˆæ¯å¤„ç†å™¨

## ğŸ”„ ä¾èµ–å…³ç³»

```
è¡¨ç¤ºå±‚ â†’ åº”ç”¨å±‚ â†’ é¢†åŸŸå±‚
     â†™         â†™
åŸºç¡€è®¾æ–½å±‚ â†’ åº”ç”¨å±‚ç«¯å£
```

### ä¾èµ–å€’ç½®åŸåˆ™
- **é¢†åŸŸå±‚**: é›¶å¤–éƒ¨ä¾èµ–ï¼Œçº¯ä¸šåŠ¡é€»è¾‘
- **åº”ç”¨å±‚**: åªä¾èµ–é¢†åŸŸå±‚ï¼Œé€šè¿‡ç«¯å£å®šä¹‰å¤–éƒ¨éœ€æ±‚
- **åŸºç¡€è®¾æ–½å±‚**: å®ç°åº”ç”¨å±‚ç«¯å£ï¼Œæä¾›æŠ€æœ¯å®ç°
- **è¡¨ç¤ºå±‚**: ä¾èµ–åº”ç”¨å±‚ç”¨ä¾‹ï¼Œå¤„ç†å¤–éƒ¨äº¤äº’

## ğŸš€ å¯åŠ¨æ–¹å¼

### åŸæœ‰æ¶æ„
```bash
go run cmd/server/main.go
```

### å…­è¾¹å½¢æ¶æ„ 
```bash
go run cmd/hexagonal_server/main.go
```

## ğŸ“Š æ¶æ„ä¼˜åŠ¿

### âœ… å¯æµ‹è¯•æ€§
- ä¸šåŠ¡é€»è¾‘ä¸æŠ€æœ¯å®ç°åˆ†ç¦»
- é€šè¿‡æ¨¡æ‹Ÿæ¥å£è½»æ¾è¿›è¡Œå•å…ƒæµ‹è¯•
- ç”¨ä¾‹å±‚å¯ç‹¬ç«‹æµ‹è¯•

### âœ… å¯ç»´æŠ¤æ€§  
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- é«˜å†…èšï¼Œä½è€¦åˆ
- æ˜“äºç†è§£å’Œä¿®æ”¹

### âœ… å¯æ‰©å±•æ€§
- æ–°å¢åŠŸèƒ½åªéœ€å®ç°ç›¸åº”ç«¯å£
- æŠ€æœ¯æ ˆæ›´æ¢ä¸å½±å“ä¸šåŠ¡é€»è¾‘
- æ”¯æŒå¤šç§åè®®å’Œå­˜å‚¨æ–¹å¼

### âœ… ä¸šåŠ¡ä¼˜å…ˆ
- é¢†åŸŸæ¨¡å‹é©±åŠ¨è®¾è®¡
- ä¸šåŠ¡è§„åˆ™é›†ä¸­ç®¡ç†
- æŠ€æœ¯ç»†èŠ‚å¤–ç½®

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### ç«¯å£æ¥å£

#### æ•°æ®ä»“å‚¨ç«¯å£
```go
type UserRepository interface {
    Save(ctx context.Context, user *entities.User) error
    GetByID(ctx context.Context, id string) (*entities.User, error)
    GetByUsername(ctx context.Context, username string) (*entities.User, error)
    // ...æ›´å¤šæ–¹æ³•
}
```

#### å¤–éƒ¨æœåŠ¡ç«¯å£
```go  
type PasswordService interface {
    HashPassword(password string) (string, error)
    VerifyPassword(hashedPassword, password string) bool
}

type IDGenerator interface {
    GenerateUserID() string
    GenerateMessageID() string
    // ...æ›´å¤šæ–¹æ³•
}
```

### ç”¨ä¾‹ç¼–æ’

```go
type UserUseCase struct {
    userRepo        ports.UserRepository
    passwordSvc     ports.PasswordService
    authSvc         ports.AuthService
    // ...æ›´å¤šä¾èµ–
}

func (uc *UserUseCase) Register(ctx context.Context, req *RegisterRequest) (*RegisterResponse, error) {
    // 1. éªŒè¯ä¸šåŠ¡è§„åˆ™
    // 2. åˆ›å»ºé¢†åŸŸå®ä½“  
    // 3. è°ƒç”¨ä»“å‚¨ä¿å­˜
    // 4. è¿”å›ç»“æœ
}
```

### ä¾èµ–æ³¨å…¥

```go
func main() {
    // 1. åŸºç¡€è®¾æ–½å±‚é€‚é…å™¨
    userRepo := persistence.NewUserRepositoryAdapter(db)
    passwordSvc := external.NewPasswordServiceAdapter()
    
    // 2. åº”ç”¨å±‚ç”¨ä¾‹
    userUseCase := usecases.NewUserUseCase(userRepo, passwordSvc, ...)
    
    // 3. è¡¨ç¤ºå±‚å¤„ç†å™¨
    userHandler := http.NewUserHandler(userUseCase)
    
    // 4. è·¯ç”±é…ç½®
    setupRoutes(r, userHandler)
}
```

## ğŸ“ å®ç°ç‰¹ç‚¹

### ğŸ¯ é¢†åŸŸé©±åŠ¨è®¾è®¡
- ç”¨æˆ·å®ä½“å°è£…ä¸šåŠ¡è¡Œä¸º
- å€¼å¯¹è±¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- ä¸šåŠ¡è§„åˆ™åœ¨é¢†åŸŸå±‚é›†ä¸­ç®¡ç†

### ğŸ”Œ æ’ä»¶å¼æ¶æ„
- å­˜å‚¨å¯åˆ‡æ¢ï¼šMySQLã€MongoDBã€å†…å­˜ç­‰
- åè®®å¯æ‰©å±•ï¼šHTTPã€WebSocketã€gRPCç­‰  
- æœåŠ¡å¯æ›¿æ¢ï¼šè®¤è¯ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰

### ğŸ§ª æµ‹è¯•å‹å¥½
- Mockæ¥å£è½»æ¾æµ‹è¯•ç”¨ä¾‹
- ä¸šåŠ¡é€»è¾‘æ— å¤–éƒ¨ä¾èµ–
- é›†æˆæµ‹è¯•é€šè¿‡æ›¿æ¢é€‚é…å™¨å®ç°

## ğŸ”® æ‰©å±•æ–¹å‘

### çŸ­æœŸæ‰©å±•
1. **å®Œå–„æ¶ˆæ¯ç”¨ä¾‹**: å®ç°æ¶ˆæ¯å‘é€ã€æ’¤å›ç­‰å®Œæ•´åŠŸèƒ½
2. **WebSocketé€‚é…å™¨**: æ”¯æŒå®æ—¶æ¶ˆæ¯æ¨é€
3. **ç¾¤ç»„ç®¡ç†ç”¨ä¾‹**: ç¾¤ç»„åˆ›å»ºã€æˆå‘˜ç®¡ç†ç­‰
4. **æ–‡ä»¶ä¸Šä¼ ç”¨ä¾‹**: æ–‡ä»¶å­˜å‚¨å’Œç®¡ç†

### ä¸­æœŸæ‰©å±•  
1. **äº‹ä»¶é©±åŠ¨**: å¼•å…¥é¢†åŸŸäº‹ä»¶ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†
2. **CQRSæ¨¡å¼**: è¯»å†™åˆ†ç¦»ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
3. **å¤šç§Ÿæˆ·æ”¯æŒ**: ä¼ä¸šçº§å¤šç§Ÿæˆ·æ¶æ„
4. **å¾®æœåŠ¡æ‹†åˆ†**: æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†ç‹¬ç«‹æœåŠ¡

### é•¿æœŸæ¼”è¿›
1. **Event Sourcing**: äº‹ä»¶æº¯æºï¼Œå®Œæ•´ä¸šåŠ¡è½¨è¿¹
2. **DDDèšåˆ**: å¤æ‚é¢†åŸŸå»ºæ¨¡
3. **åˆ†å¸ƒå¼äº‹åŠ¡**: Sagaæ¨¡å¼å¤„ç†è·¨æœåŠ¡äº‹åŠ¡
4. **äº‘åŸç”Ÿæ¶æ„**: å®¹å™¨åŒ–ã€æœåŠ¡ç½‘æ ¼ç­‰

## ğŸ“š ç›¸å…³èµ„æº

- [å…­è¾¹å½¢æ¶æ„åŸç†](https://alistair.cockburn.us/hexagonal-architecture/)
- [é¢†åŸŸé©±åŠ¨è®¾è®¡](https://domainlanguage.com/ddd/)
- [æ¸…æ´æ¶æ„](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

## ğŸ¤ å¼€å‘è§„èŒƒ

### æ–°å¢åŠŸèƒ½æµç¨‹
1. **åˆ†æä¸šåŠ¡éœ€æ±‚** â†’ ç¡®å®šæ¶‰åŠçš„é¢†åŸŸæ¦‚å¿µ
2. **è®¾è®¡é¢†åŸŸæ¨¡å‹** â†’ åˆ›å»º/æ‰©å±•å®ä½“å’Œå€¼å¯¹è±¡  
3. **å®šä¹‰ç«¯å£æ¥å£** â†’ æŠ½è±¡å¤–éƒ¨ä¾èµ–
4. **å®ç°ç”¨ä¾‹é€»è¾‘** â†’ ç¼–æ’ä¸šåŠ¡æµç¨‹
5. **åˆ›å»ºé€‚é…å™¨** â†’ å®ç°æŠ€æœ¯ç»†èŠ‚
6. **æ·»åŠ å¤„ç†å™¨** â†’ æš´éœ²å¤–éƒ¨æ¥å£

### ä»£ç è§„èŒƒ
- é¢†åŸŸå±‚ç¦æ­¢å¼•å…¥å¤–éƒ¨ä¾èµ–
- æ¥å£å®šä¹‰è¦ç®€æ´æ˜ç¡®
- ç”¨ä¾‹æ–¹æ³•è¦åŸå­åŒ–
- é”™è¯¯å¤„ç†è¦ç»Ÿä¸€
- æ—¥å¿—è®°å½•è¦ç»“æ„åŒ–

---

**é‡æ„å®Œæˆï¼** ğŸ‰

é¡¹ç›®ç°åœ¨å…·å¤‡äº†æ›´å¥½çš„æ¶æ„åŸºç¡€ï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å’ŒæŠ€æœ¯æ¼”è¿›å¥ å®šäº†åšå®åŸºç¡€ã€‚ 